import { useState, useEffect } from 'react';
import axios from 'axios';

export const useFetch = (url) => {

    const [isLoading, setIsLoading] = useState(false);
    const [isError, setError] = useState(null);
    const [response, setResponse] = useState(null);
    const [options, setOptions] = useState({})

    const baseUrl = 'https://conduit.productionready.io/api/';

    useEffect(() => {
        if(!isLoading) return;
        doFetch(options);
    }, [isLoading]);

    const doFetch = async (params={}) => {
        try {
            setOptions(params);
            const responseData = await axios(`${baseUrl + url}`, params);
            setResponse(responseData);
            setIsLoading(false);
        } catch (error) {
            setError(error);
            setIsLoading(false);
        }
    }

    return [
        { response, isLoading, isError },
        doFetch
    ]
} 