import React, { useEffect, useContext } from 'react';
import { useFetch, useLocalStorage } from 'hooks';
import { CurrentUserContext } from 'context';

export const CurrentUserChecker = ({children}) => {

    const [{ response }, doFetch] = useFetch('user');
    const [, setCurrentUserState] = useContext(CurrentUserContext);
    const [token] = useLocalStorage('token');

    useEffect(() => {
        if(!token) return;
        doFetch();
        setCurrentUserState(state => ({
                    ...state,
                    isLoading: true,
                })
            );
    }, [doFetch, setCurrentUserState, token]);

    useEffect(() => {
        if(!response) return;
        setCurrentUserState(state => ({
                ...state,
                isLoading: false,
                isLoggedIn: true,
                currentUser: response.user
            })
        );
    }, [response, setCurrentUserState])

    return children;
};
