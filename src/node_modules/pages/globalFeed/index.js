import React, { useEffect, useState } from 'react'

import { useFetch } from 'hooks';
import { stringify } from "query-string";
import { Feed, Pagination, PopularTags, ErrorMsg, Loading, FeedToggler } from 'components';
import { limit, getPaginator } from 'utils';

const GlobalFeed = ({ location, match }) => {
  const { currentPage, offset } = getPaginator(location.search);

  const stringifyParams = stringify({
    limit,
    offset
  });

  const url = match.url;

  const apiUrl = `/articles?${stringifyParams}`;

  const [{response, isLoading, error}, fetchArticles] = useFetch(apiUrl);

  useEffect(() => {
    fetchArticles();
  }, [fetchArticles, currentPage])

  return (
    <div className="home-page">
      <div className="banner">
        <div className="container">
          <h1>Medium clone</h1>
          <p>
            A place to share knowlege
          </p>
        </div>
      </div>
      <div className="container page">
        <div className="row">
          <div className="col-md-9">
            <FeedToggler />
            {
              isLoading && <Loading />
            }
            {  
              error && <ErrorMsg />
            }
            {
              !isLoading && response && (
                <>
                  <Feed articles={response.articles} />
                  <Pagination 
                    total={response.articlesCount} 
                    limit={limit} 
                    url={url} 
                    currentPage={currentPage} 
                  />
                </>
              )
            }
          </div>
          <div className="col-md-3">
            <PopularTags />
          </div>
        </div>
      </div>
      
    </div>
  )
}

export default GlobalFeed
